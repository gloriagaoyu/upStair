{"version":3,"sources":["../../../../assets/Script/assets/Script/game.js"],"names":["com","require","cc","Class","extends","Component","properties","audioSource","default","type","AudioSource","tyAudioSource","player","Node","qwPlayer","xmPlayer","stair","Prefab","dgStair","lyStair","nodeView","timer","Label","stairIsLeft","preStairX","preStairY","stairWidth","stairHeight","playersPos","nowSelectPlayer","timers","onLoad","manager","director","getCollisionManager","enabled","active","showPlayerRandom","Math","random","playerIndex","setPosition","node","on","EventType","TOUCH_START","onTouchStart","newFirstStair","play","string","updateTimes","that","times","setInterval","gameOverThen","clearInterval","newStair","instantiate","addChild","x","y","i","randDirector","newOtherStair","randomNum","randStair","nextStair","direction","playTyMusic","playerMove","toRight","up","moveTo","p","down","runAction","sequence","callFunc","scaleX","viewMoveX","moveBy","checkMoveIsRight","setTimeout","event","off","touchLoction","touch","getLocation","isRight","width","toLeft","nextStairPos","childrens","children","length","playerScore","gameOver","loadScene"],"mappings":"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","file":"game.js","sourceRoot":"../../../../assets/Script","sourcesContent":["\nvar com=require('Common');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        audioSource:{\n            default:null,\n            type:cc.AudioSource,\n        },\n        tyAudioSource:{\n            default:null,\n            type:cc.AudioSource,\n        },\n        player:{\n            default:null,\n            type:cc.Node\n        },\n        qwPlayer:{\n            default:null,\n            type:cc.Node\n        },\n        xmPlayer:{\n            default:null,\n            type:cc.Node\n        },\n        stair:{\n            default:null,\n            type:cc.Prefab\n        },\n        dgStair:{\n            default:null,\n            type:cc.Prefab\n        },\n        lyStair:{\n            default:null,\n            type:cc.Prefab\n        },\n        nodeView:{\n            default:null,\n            type:cc.Node\n        },\n        timer:{\n            default:null,\n            type:cc.Label\n        },\n        stairIsLeft:true,\n        preStairX:0,\n        preStairY:0,\n        stairWidth:192,\n        stairHeight:87,\n        playersPos:0,\n        nowSelectPlayer:0,\n        timers:60,\n    },\n\n    \n\n    onLoad () {\n        var manager=cc.director.getCollisionManager();\n        manager.enabled=false;\n        this.player.active=false;\n        this.qwPlayer.active=false;\n        this.xmPlayer.active=false;\n        var showPlayerRandom=Math.random();\n        //this.nowSelectPlayer=showPlayerRandom>0.5?this.player:this.qwPlayer;\n        if(com.playerIndex==0){\n            this.nowSelectPlayer=this.qwPlayer;\n        }else if(com.playerIndex==1){\n            this.nowSelectPlayer=this.player;\n        }else{\n            this.nowSelectPlayer=this.xmPlayer;\n        }\n        //this.nowSelectPlayer=com.playerIndex==1?this.player:this.qwPlayer;\n        this.nowSelectPlayer.active=true;\n        this.nowSelectPlayer.setPosition(0,-250);\n        this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this);\n        this.newFirstStair();\n        this.audioSource.play();\n        this.timer.string=this.timers+\"s\";\n        this.updateTimes();\n        \n    },\n\n    updateTimes:function(){\n        var that=this;\n        var times=setInterval(function(){\n            that.timers=that.timers-1;\n            if(that.timers<0){\n                that.gameOverThen();\n                clearInterval(times);\n            }else{\n                that.timer.string=that.timers+\"s\";\n            }\n            \n        },1000);\n    },\n\n    newFirstStair:function(){\n        var newStair=cc.instantiate(this.stair);\n        this.nodeView.addChild(newStair,-1);\n        newStair.setPosition(this.nowSelectPlayer.x,this.nowSelectPlayer.y-125);\n        this.preStairX=newStair.x;\n        this.preStairY=newStair.y;\n        for(var i=0;i<10;i++){\n            var randDirector=Math.random();\n            this.newOtherStair(randDirector);\n        }\n    },\n\n    newOtherStair:function(randomNum){\n        this.stairIsLeft=randomNum<0.5?false:true;\n        var randStair=Math.random();\n        var nextStair;\n        if(randStair<0.33){\n            nextStair=this.stair;\n        }else if(randStair>0.33&&randStair<0.66){\n            nextStair=this.dgStair;\n        }else{\n            nextStair=this.lyStair;\n        }\n        var newOtherStair=cc.instantiate(nextStair);\n        newOtherStair.direction=this.stairIsLeft;\n        this.nodeView.addChild(newOtherStair);\n\n        if(this.stairIsLeft) {\n            newOtherStair.setPosition(this.preStairX-this.stairWidth/2,this.preStairY+100);\n        }else{\n            newOtherStair.setPosition(this.preStairX+this.stairWidth/2,this.preStairY+100);\n        }\n        this.preStairX=newOtherStair.x;\n        this.preStairY=newOtherStair.y;\n    },\n\n    playTyMusic:function(){\n        this.tyAudioSource.play();\n    },\n\n\n    playerMove:function(toRight){\n        var up=cc.moveTo(0.1,cc.p(this.nowSelectPlayer.x,this.nowSelectPlayer.y+this.stairHeight));\n        var down=cc.moveTo(0.1,cc.p(this.nowSelectPlayer.x,this.nowSelectPlayer.y));\n        this.nowSelectPlayer.runAction(cc.sequence(up,down,cc.callFunc(this.playTyMusic())));\n        var scaleX=1;\n        var viewMoveX=96;\n        if(toRight){\n            scaleX=-1;\n            viewMoveX=-96;\n        } \n        this.nowSelectPlayer.scaleX=scaleX;\n        this.nodeView.runAction(cc.moveBy(0.1,cc.p(viewMoveX,-100)));\n        this.playersPos+=1;\n        var that=this;\n        if(!this.checkMoveIsRight(!toRight,this.playersPos)){\n            this.gameOverThen();\n        }else{\n            var randDirector=Math.random();   \n            this.newOtherStair(randDirector);\n            setTimeout(function() {\n                 that.node.on(cc.Node.EventType.TOUCH_START,that.onTouchStart,that)\n             }, 200);\n        }\n    },\n\n    onTouchStart:function(event){ \n        this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this);\n        var touchLoction=event.touch.getLocation();\n        var isRight=touchLoction.x>this.node.width/2;\n        this.playerMove(isRight);\n    },\n\n    checkMoveIsRight:function(toLeft,nextStairPos){\n        var childrens=this.nodeView.children;\n        for(var i=0;i<childrens.length;i++){\n            if(childrens[nextStairPos].direction==toLeft){\n                return true;\n            }\n        }\n        return false;\n    },\n\n    gameOverThen:function(){\n        com.playerScore = this.playersPos-1;\n        this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this);\n        var up=cc.moveTo(0.1,cc.p(this.nowSelectPlayer.x,this.nowSelectPlayer.y+this.stairHeight));\n        var down=cc.moveTo(0.5,cc.p(this.nowSelectPlayer.x,this.nowSelectPlayer.y-400));\n        this.nowSelectPlayer.runAction(cc.sequence(up,down,cc.callFunc(this.gameOver)));\n    },\n\n    gameOver:function(){\n        cc.director.loadScene('gameOver');\n    },\n\n    // update (dt) {},\n});\n"]}